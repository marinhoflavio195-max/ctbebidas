<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rái Delivery</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; margin:0; background:#fff; }
header { background:red; color:#fff; padding:10px; display:flex; align-items:center; justify-content:space-between; }
header img { height:50px; object-fit:contain; }
header h1 { margin:0; font-size:1.5em; }
.cart { position:relative; cursor:pointer; }
.cart-count { position:absolute; top:-5px; right:-10px; background:#fff; color:red; font-weight:bold; border-radius:50%; padding:2px 6px; font-size:0.8em; }
#categoria-buttons { display:flex; gap:10px; padding:10px; justify-content:center; flex-wrap:wrap; }
#categoria-buttons button { background:red; color:#fff; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; }
.product-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr)); gap:10px; padding:10px; }
.product { border:1px solid #ccc; border-radius:5px; padding:10px; text-align:center; background:#fff; }
.product img { width:100%; height:120px; object-fit:contain; margin-bottom:5px; }
.product button { margin-top:5px; padding:5px 10px; background:red; color:#fff; border:none; cursor:pointer; border-radius:3px; }
.cart-modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.cart-content { background:#fff; width:90%; max-width:500px; padding:20px; border-radius:5px; max-height:90%; overflow-y:auto; position:relative; }
.close-cart { position:absolute; top:10px; right:10px; cursor:pointer; color:red; font-size:1.2em; }
.cart-item { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #ccc; padding:5px 0; }
.cart-item button { padding:2px 6px; margin-left:5px; }
.payment { margin-top:10px; }
.payment input, .payment select { width:100%; padding:5px; margin:5px 0; }
.checkout-btn { background:red; color:#fff; padding:10px; width:100%; border:none; cursor:pointer; margin-top:10px; border-radius:5px; }
#map { width:100%;height:200px;margin-top:10px;display:none; }
</style>
</head>
<body>

<header>
    <img src="img/logo.png" alt="Rái Delivery">
    <h1>Rái Delivery</h1>
    <div class="cart" onclick="toggleCart()">
        <i class="fas fa-shopping-cart fa-2x"></i>
        <span class="cart-count" id="cart-count">0</span>
    </div>
</header>

<div id="categoria-buttons"></div>
<main id="products" class="product-grid"></main>

<div class="cart-modal" id="cart-modal">
    <div class="cart-content">
        <span class="close-cart" onclick="toggleCart()">&times;</span>
        <h2>Carrinho</h2>
        <div id="cart-items"></div>
        <p id="cart-total">Total: R$ 0,00</p>
        <div class="payment">
            <label>Forma de Pagamento:</label>
            <select id="payment-method">
                <option value="pix">Pix</option>
                <option value="dinheiro">Dinheiro</option>
                <option value="cartao">Cartão de Crédito/Débito</option>
            </select>
            <label>Tipo de Entrega:</label>
            <select id="delivery-type">
                <option value="entrega">Entrega</option>
                <option value="retirada">Retirada no Local</option>
            </select>

            <div id="pix-section" style="display:none;">
                <p>Pix: 99981050024</p>
                <p>Chave: Telefone</p>
                <button onclick="generatePixQRCode()">Gerar QR Code</button>
                <div id="pix-qr"></div>
                <label>Enviar Comprovante:</label>
                <input type="file" id="pix-proof" accept="image/*">
            </div>

            <div id="map"></div>
        </div>

        <button class="checkout-btn" onclick="checkout()">Finalizar Pedido</button>
    </div>
</div>

<script>
// Categorias
const categorias = [
  {id:'cervejas', nome:'Cervejas'},
  {id:'refrigerantes', nome:'Refrigerantes'},
  {id:'aguas', nome:'Água'}
];

// Produtos
const produtos = [];
for(let i=1;i<=80;i++){
    produtos.push({id:i,nome:`Cerveja ${i}`,preco:(3+i*0.1),imagem:`img/cerveja${i}.png`,categoria:'cervejas'});
}
produtos.push({id:81,nome:'Coca Cola 2L',preco:9.5,imagem:'img/refrigerante1.png',categoria:'refrigerantes'});
produtos.push({id:82,nome:'Pepsi 2L',preco:9.0,imagem:'img/refrigerante2.png',categoria:'refrigerantes'});
produtos.push({id:101,nome:'Água Mineral 500ml',preco:2.5,imagem:'img/agua1.png',categoria:'aguas'});
produtos.push({id:102,nome:'Água Mineral 1L',preco:4.5,imagem:'img/agua2.png',categoria:'aguas'});

const categoriaButtons = document.getElementById('categoria-buttons');
const productsContainer = document.getElementById('products');

// Botões de categoria
categorias.forEach(cat=>{
  const btn = document.createElement('button');
  btn.innerText = cat.nome;
  btn.onclick = ()=> renderProdutos(cat.id);
  categoriaButtons.appendChild(btn);
});

// Render produtos por categoria
function renderProdutos(categoriaId){
  productsContainer.innerHTML = '';
  const filtrados = produtos.filter(p => p.categoria === categoriaId);
  filtrados.forEach(p=>{
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `
      <img src="${p.imagem}" alt="${p.nome}">
      <h4>${p.nome}</h4>
      <p>R$ ${p.preco.toFixed(2)}</p>
      <div style="display:flex; align-items:center; justify-content:center; gap:5px; margin-bottom:5px;">
        <button onclick="changeProductQty(${p.id}, -1)">-</button>
        <input type="number" id="qty-${p.id}" value="1" min="1" style="width:40px; text-align:center;">
        <button onclick="changeProductQty(${p.id}, 1)">+</button>
      </div>
      <button onclick="addToCart(${p.id})">Adicionar</button>
    `;
    productsContainer.appendChild(div);
  });
}

renderProdutos('cervejas');

let cart = [];

function addToCart(id){
    const produto = produtos.find(p => p.id === id);
    const qty = parseInt(document.getElementById(`qty-${id}`).value);

    const existing = cart.find(c => c.id === id);
    if(existing){
        existing.quantidade = qty; // SUBSTITUI a quantidade, não soma
    } else {
        cart.push({...produto, quantidade: qty});
    }
    updateCart();
}

function removeFromCart(id){
    cart = cart.filter(c=>c.id!==id);
    updateCart();
}

function changeQuantity(id,delta){
    const item = cart.find(c=>c.id===id);
    if(item){
        item.quantidade += delta;
        if(item.quantidade < 1) item.quantidade = 1;
    }
    updateCart();
}

function changeProductQty(id, delta){
    const input = document.getElementById(`qty-${id}`);
    let current = parseInt(input.value);
    current += delta;
    if(current < 1) current = 1;
    input.value = current;
}

function updateCart(){
    const cartItems = document.getElementById('cart-items');
    cartItems.innerHTML = '';
    let total = 0;
    cart.forEach(c=>{
        total += c.preco * c.quantidade;
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
            <span>${c.nome} R$ ${c.preco.toFixed(2)} x ${c.quantidade}</span>
            <div>
                <button onclick="changeQuantity(${c.id},-1)">-</button>
                <button onclick="changeQuantity(${c.id},1)">+</button>
                <button onclick="removeFromCart(${c.id})">X</button>
            </div>
        `;
        cartItems.appendChild(div);
    });
    document.getElementById('cart-total').innerText = `Total: R$ ${total.toFixed(2)}`;
    document.getElementById('cart-count').innerText = cart.reduce((acc,c)=>acc+c.quantidade,0);
}

function toggleCart(){
    const modal = document.getElementById('cart-modal');
    modal.style.display = modal.style.display==='flex'?'none':'flex';
}

document.getElementById('payment-method').addEventListener('change',e=>{
    document.getElementById('pix-section').style.display = e.target.value==='pix'?'block':'none';
});

// Google Maps
let map;
function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: -5.527, lng: -47.493 },
        zoom: 17
    });
    new google.maps.Marker({
        position: { lat: -5.527, lng: -47.493 },
        map: map,
        title: "Rái Delivery - Retirada"
    });
}

document.getElementById('delivery-type').addEventListener('change', e => {
    const mapDiv = document.getElementById('map');
    if(e.target.value === 'retirada'){
        mapDiv.style.display = 'block';
        initMap();
    } else {
        mapDiv.style.display = 'none';
    }
});

function generatePixQRCode(){
    const total = cart.reduce((acc,c)=>acc+c.preco*c.quantidade,0);
    const qrDiv = document.getElementById('pix-qr');
    qrDiv.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?data=PIX 99981050024 valor R$${total.toFixed(2)}&size=150x150" alt="Pix QR">`;
}

function checkout(){
    const total = cart.reduce((acc,c)=>acc+c.preco*c.quantidade,0);
    if(total<100){
        alert("Entrega somente para pedidos acima de R$100,00.");
        return;
    }
    alert("Pedido finalizado! Total: R$" + total.toFixed(2));
    cart = [];
    updateCart();
    toggleCart();
}
</script>

<script async src="https://maps.googleapis.com/maps/api/js?key=SEU_API_KEY"></script>

</body>
</html>
